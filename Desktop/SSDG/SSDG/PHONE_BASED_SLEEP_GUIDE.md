# 睡眠数据生成指南 - 真实iPhone记录模式

## 概述
优化后的睡眠数据生成方案完全模拟了iPhone在无穿戴设备模式下的睡眠记录方式，只生成卧床时间段，间隔为自然空白，更贴合真实设备的记录。

## 主要特性

### 1. 只生成卧床时间段
- 不生成清醒时间段
- 间隔是自然的空白，不是清醒段
- 与真实iPhone记录保持一致

### 2. 调整后的睡眠时间

#### 夜猫子型（Night Owl）
- 凌晨2-4点睡觉
- 中午12-15点起床
- 80%概率一个连续段
- 20%概率两个段（睡前短暂休息）

#### 早起型（Early Bird）
- 晚上21-22点睡觉
- 早上5-6点起床
- 几乎总是一个连续的睡眠段
- 睡眠质量最好

#### 正常型（Normal）
- 晚上22:30-23:30睡觉
- 早上7-8点起床
- 90%概率一个段
- 10%概率两个段（夜间上厕所）

#### 紊乱型（Irregular）
- 完全不规律的作息时间
- 可能晚上8点睡到凌晨4点
- 可能凌晨4点睡到下午2点
- 60%一个段，30%两个段，10%三个段

## 数据示例

```
夜猫子型用户的睡眠数据
----------------------------------------
基本信息:
  入睡时间: 2024-08-07 02:30:00 +0000
  起床时间: 2024-08-07 13:00:00 +0000
  总时长: 10.50小时
  段落总数: 1

段落分析:
  卧床时间段: 1个
  间隔（空白）: 无

时间线详情:
  1. 02:30-13:00 (10小时30分钟)
```

```
正常型用户的睡眠数据（有间隔）
----------------------------------------
基本信息:
  入睡时间: 2024-08-06 23:00:00 +0000
  起床时间: 2024-08-07 07:30:00 +0000
  总时长: 8.50小时
  段落总数: 2

段落分析:
  卧床时间段: 2个
  间隔（空白）: 1个

时间线详情:
  1. 23:00-03:30 (4小时30分钟)
  2. 03:40-07:30 (3小时50分钟)

段落间隔:
  间隔1: 10分钟
```

## 技术实现

1. **PersonalizedDataGenerator.swift**
   - `generateEnhancedSimpleSleep` 方法实现新的生成逻辑
   - 只生成卧床时间段（SleepStage.light）
   - 根据睡眠类型控制段数概率

2. **HealthKitManager.swift**
   - 只为睡眠段创建inBed类型的HKCategorySample
   - 忽略所有awake类型的段（如果有）
   - 每个段创建独立的样本

3. **测试验证**
   - `TestPhoneBasedSleep.swift` 提供详细的测试和验证
   - 显示卧床段数量和间隔时长

## 使用建议

1. 生成的数据会在Health应用中显示为1-3个卧床时间段
2. 段与段之间的间隔是自然空白，符合真实记录
3. 睡眠时间根据用户类型自动调整
4. 大多数情况下只会有一个连续的睡眠段

## 注意事项

- 此方案仅适用于简单模式（.simple）
- 可穿戴设备模式（.wearableDevice）仍使用详细的睡眠阶段
- 不会生成0分钟的段，所有段都有实际时长
- 紊乱型用户可能出现不规律的多段睡眠