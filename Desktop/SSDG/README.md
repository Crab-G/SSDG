# SSDG - 虚拟用户数据生成器

![iOS](https://img.shields.io/badge/iOS-15.0+-blue.svg)
![Swift](https://img.shields.io/badge/Swift-5.5+-orange.svg)
![Xcode](https://img.shields.io/badge/Xcode-14.0+-blue.svg)

## 📱 项目简介

SSDG（Smart Sleep & Step Data Generator）是一个iOS应用，用于生成虚拟用户数据并同步到Apple Health。该应用可以模拟真实的睡眠和步数数据，适用于健康应用开发测试、数据分析研究等场景。

## ✨ 核心功能

- 🧑‍💼 **虚拟用户生成**: 生成具有合理属性的虚拟用户（年龄、性别、身高、体重等）
- 🏃‍♂️ **基准值计算**: 为每个用户计算个性化的睡眠和步数基准值
- 🔄 **一致性随机数**: 基于用户ID的哈希值生成一致性随机数
- 📊 **数据摘要**: 显示用户的健康数据预览和统计信息
- 🏥 **Apple Health集成**: 同步数据到Apple Health应用（即将实现）
- 🧪 **内置测试**: 提供完整的测试套件验证功能正确性

## 🚀 当前进展

### ✅ 已完成功能

1. **用户界面设计**
   - 现代化暗色科技风格界面
   - 响应式设计，适配不同设备
   - 毛玻璃效果和渐变设计
   - 加载动画和状态管理

2. **虚拟用户生成逻辑**
   - 完整的用户模型和数据结构
   - 智能的属性生成算法
   - 基于性别的体重分布调整
   - BMI计算和健康分类
   - 睡眠和步数基准值生成

3. **测试框架**
   - 单元测试和集成测试
   - 数据有效性验证
   - 统计分析功能
   - 控制台输出和调试工具

### ✅ 已完成功能

4. **HealthKit集成功能**
   - 完整的HealthKit权限管理
   - 睡眠数据写入（包含睡眠阶段）
   - 步数数据写入（包含小时分布）
   - 错误处理和状态管理
   - 权限状态实时显示

5. **高级数据生成算法**
   - 历史数据生成（30-120天）
   - 睡眠阶段模拟（轻度、深度、REM、清醒）
   - 日内步数分布模拟
   - 数据一致性保证
   - 符合生理规律的数据生成

### 🔄 正在开发

- 每日数据生成逻辑
- 后台数据同步

### 📋 待开发功能

- 后台数据同步
- 数据导出功能
- 数据可视化图表
- 自定义数据生成参数

## 🏗️ 项目架构

```
SSDG/
├── SSDGApp.swift           # 应用入口
├── ContentView.swift       # 主界面
├── VirtualUser.swift       # 虚拟用户模型和生成器
├── VirtualUserTests.swift  # 用户生成测试套件
├── HealthKitManager.swift  # HealthKit集成管理器
├── DataGenerator.swift     # 数据生成算法
├── HealthKitTests.swift    # HealthKit集成测试套件
└── Assets.xcassets/        # 资源文件
```

### 核心类和结构

#### 用户生成模块
- **VirtualUser**: 虚拟用户数据模型
- **VirtualUserGenerator**: 用户生成器，包含智能算法
- **SeededRandomGenerator**: 种子随机数生成器，确保一致性
- **UserStatistics**: 用户统计分析工具

#### HealthKit集成模块
- **HealthKitManager**: HealthKit集成管理器，处理权限和数据同步
- **SleepData**: 睡眠数据模型，包含睡眠阶段
- **StepsData**: 步数数据模型，包含小时分布
- **DataGenerator**: 高级数据生成算法

#### 测试模块
- **VirtualUserTests**: 用户生成测试套件
- **HealthKitTests**: HealthKit集成测试套件

## 📊 数据模型

### 用户属性
- **年龄**: 18-80岁
- **性别**: 男/女/其他
- **身高**: 150.0-200.0厘米
- **体重**: 50.0-100.0公斤（基于BMI智能计算）
- **睡眠基准**: 7.0-9.0小时
- **步数基准**: 5,000-15,000步

### 计算字段
- **BMI**: 自动计算并分类（偏瘦/正常/偏胖/肥胖）
- **睡眠类型**: 短睡眠型/标准睡眠型/长睡眠型
- **活跃度**: 低活跃度/中等活跃度/高活跃度/极高活跃度

## 🛠️ 使用方法

### 在Xcode中运行

1. 打开 `SSDG.xcodeproj`
2. **重要**: 在项目设置中启用HealthKit功能
   - 选择项目 → Signing & Capabilities
   - 点击 + Capability
   - 添加 HealthKit
3. 添加HealthKit权限描述到Info.plist：
   ```xml
   <key>NSHealthShareUsageDescription</key>
   <string>此应用需要访问HealthKit以读取健康数据</string>
   <key>NSHealthUpdateUsageDescription</key>
   <string>此应用需要访问HealthKit以写入虚拟健康数据</string>
   ```
4. 选择模拟器或真机
5. 点击运行按钮（⌘+R）

### 应用操作

1. **生成虚拟用户**: 点击"生成虚拟用户数据"按钮
2. **查看用户信息**: 用户信息卡片显示详细属性（包含BMI、睡眠类型等）
3. **查看数据摘要**: 数据摘要卡片显示真实的历史数据统计
4. **查看HealthKit状态**: HealthKit状态卡片显示权限和处理状态
5. **同步数据**: 点击"授权并同步到Apple Health"按钮
6. **运行测试**: 点击"用户测试"或"HealthKit测试"按钮（开发阶段）

### 测试功能

应用内置了完整的测试套件，包括：

#### 用户生成测试
- 单个用户生成测试
- 批量用户生成测试
- 种子随机数一致性测试
- 用户属性范围验证
- 性别与体重相关性测试

#### HealthKit集成测试
- HealthKit可用性测试
- 权限请求测试
- 睡眠数据生成和写入测试
- 步数数据生成和写入测试
- 数据一致性测试
- 数据范围验证测试

## 🔧 技术特点

### 智能算法
- **一致性随机数**: 使用线性同余生成器确保相同用户ID产生相同数据
- **属性关联**: 根据身高和性别智能计算合理的体重范围
- **数据验证**: 完整的数据有效性检查和错误报告

### HealthKit集成
- **完整权限管理**: 自动请求和管理HealthKit权限
- **真实数据格式**: 生成符合Apple Health标准的数据格式
- **睡眠阶段模拟**: 模拟真实的睡眠周期（轻度、深度、REM、清醒）
- **活动模式模拟**: 基于生理规律的日内步数分布
- **错误处理**: 完善的错误处理和用户反馈机制

### 数据生成
- **生理规律**: 遵循真实的睡眠和活动模式
- **周末效应**: 模拟周末与工作日的差异
- **异常事件**: 15%概率的异常变化，模拟真实生活
- **连续性约束**: 确保数据的连续性和合理性
- **健康补偿**: 模拟健康恢复机制

### 代码质量
- **模块化设计**: 清晰的功能模块分离
- **可扩展性**: 易于添加新的数据类型和生成算法
- **测试覆盖**: 完整的测试套件确保代码质量
- **异步处理**: 使用现代Swift异步编程模式

## 🎯 设计理念

遵循项目规则中的要求：
- 用户属性范围符合规范
- 基准值生成逻辑合理
- 界面设计符合Apple人机界面指南
- 代码结构清晰，易于维护

## 🤖 开发规范

本项目遵循[Claude开发规则](./CLAUDE_RULES.md)，确保：
- 系统性的开发流程
- 高质量的代码标准
- 完整的任务跟踪机制
- 简单性优先的设计原则

## 📋 系统要求

- **iOS**: 15.0+
- **Xcode**: 14.0+
- **Swift**: 5.5+
- **HealthKit**: 需要在真机上测试（模拟器不支持HealthKit写入）

## ⚠️ 重要提醒

1. **HealthKit权限**: 首次使用需要在设置中手动授权HealthKit权限
2. **真机测试**: HealthKit功能需要在真机上测试，模拟器仅支持权限请求
3. **数据安全**: 生成的数据仅用于测试目的，不会收集或上传个人信息
4. **数据量限制**: 大量数据写入可能需要一定时间，请耐心等待

## 🚀 性能优化

- 异步数据生成，不阻塞主线程
- 批量数据写入，提高效率
- 内存优化，支持大量数据生成
- 错误恢复机制，确保稳定性

## 📄 许可证

本项目仅用于学习和测试目的。

## 👨‍💻 开发者

谢铭麟 - 2025年7月

---

*🎉 HealthKit集成功能已完成！现在可以生成真实的睡眠和步数数据并同步到Apple Health。* 